# 보안 키 노출 대응 가이드

## ⚠️ 중요: Firebase Private Key가 GitHub에 노출되었습니다

GitGuardian에서 감지한 보안 경고는 **실제 Firebase Private Key가 문서 파일에 포함되어 GitHub에 커밋된 것**입니다.

---

## 즉시 조치 사항

### 1. Firebase에서 키 무효화 및 새 키 생성 (최우선)

**Firebase Console에서:**
1. [Firebase Console](https://console.firebase.google.com/) 접속
2. 프로젝트 선택 (`schedule-checker-b0eb7`)
3. **프로젝트 설정** → **서비스 계정** 탭
4. **새 비공개 키 생성** 클릭
5. 새 키 파일 다운로드
6. **기존 키는 자동으로 비활성화됨** (또는 수동 삭제)

**결과:**
- 기존 노출된 키는 더 이상 사용 불가
- 새 키로 교체 필요

---

### 2. Vercel 환경 변수 업데이트

**새 키로 교체:**
1. Vercel 대시보드 → Settings → **Environment Variables**
2. `FIREBASE_PRIVATE_KEY` 환경 변수 찾기
3. 새로 생성한 키의 `private_key` 값으로 교체
4. 저장 후 **Redeploy**

**또는 3개 환경 변수 모두 업데이트:**
- `FIREBASE_PROJECT_ID` (변경 없음)
- `FIREBASE_CLIENT_EMAIL` (새 키의 `client_email`로 업데이트)
- `FIREBASE_PRIVATE_KEY` (새 키의 `private_key`로 업데이트)

---

### 3. 로컬 환경 변수 업데이트

**`.env.local` 파일:**
1. 새로 다운로드한 Firebase 키 JSON 파일 열기
2. 전체 JSON을 `FIREBASE_SERVICE_ACCOUNT_JSON`에 업데이트
3. 또는 3개 환경 변수로 분리하여 업데이트

---

### 4. Git 히스토리에서 키 제거 (선택사항)

**경고**: 이 작업은 Git 히스토리를 재작성하므로 신중하게 진행해야 합니다.

**방법 A: BFG Repo-Cleaner 사용 (권장)**
```bash
# BFG 설치 (Homebrew)
brew install bfg

# 저장소 클론
git clone --mirror https://github.com/jungshell/autoflow.git

# 키 제거
bfg --replace-text passwords.txt autoflow.git

# 히스토리 강제 푸시 (주의!)
cd autoflow.git
git reflog expire --expire=now --all
git gc --prune=now --aggressive
git push --force
```

**방법 B: git-filter-repo 사용**
```bash
# 키가 포함된 파일에서 키 제거
git filter-repo --path docs/Vercel-환경변수-설정-방법.md --invert-paths
```

**주의:**
- 이 작업은 **모든 협업자에게 영향을 줍니다**
- 팀원들에게 사전 공지 필요
- 모든 로컬 저장소를 다시 클론해야 함

---

## 예방 조치

### 1. .gitignore 확인
✅ 이미 `.env*` 파일은 `.gitignore`에 포함되어 있음

### 2. 문서 파일에서 실제 키 제거
✅ 문서 파일에서 실제 키 값 제거 완료
- `docs/Vercel-환경변수-설정-방법.md` - 실제 키 제거됨
- `docs/FIREBASE_PRIVATE_KEY-설정-가이드.md` - 실제 키 제거됨

### 3. GitGuardian 또는 GitHub Secret Scanning 활성화
- GitHub 저장소 → Settings → Security → Secret scanning
- 자동으로 감지하여 알림

---

## 확인 사항

### 즉시 확인
- [ ] Firebase에서 새 키 생성 완료
- [ ] Vercel 환경 변수 업데이트 완료
- [ ] 로컬 `.env.local` 업데이트 완료
- [ ] 앱이 정상 작동하는지 테스트

### 추가 확인
- [ ] GitGuardian 경고가 해결되었는지 확인
- [ ] 다른 문서 파일에 키가 없는지 확인
- [ ] 코드 파일에 하드코딩된 키가 없는지 확인

---

## 참고

### 노출된 키의 영향
- **Firebase 데이터베이스 접근 가능** (키가 유효한 동안)
- **Firestore 읽기/쓰기 가능**
- **Firebase Admin SDK 권한으로 모든 데이터 접근 가능**

### 키 교체 후
- 기존 키는 즉시 무효화됨
- 새 키로만 접근 가능
- Vercel 환경 변수 업데이트 필수

---

## 요약

1. ✅ **문서에서 실제 키 제거 완료**
2. ⚠️ **Firebase에서 새 키 생성 필요** (최우선)
3. ⚠️ **Vercel 환경 변수 업데이트 필요**
4. ⚠️ **로컬 `.env.local` 업데이트 필요**
5. 선택: Git 히스토리에서 키 제거 (팀 협의 후)

**가장 중요한 것은 Firebase에서 새 키를 생성하고 모든 환경 변수를 업데이트하는 것입니다.**
