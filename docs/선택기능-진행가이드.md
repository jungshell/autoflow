# 선택 기능 진행 가이드

선택 사항 1~3, Slack 알림, Google Calendar, 모바일 UI/UX 진행 시 참고용입니다.

---

## 1. Firestore 규칙 배포

**방법 A — 터미널 (Firebase CLI)**

```bash
cd "/Volumes/Samsung USB/schedule_checker"
npx firebase-tools login
npx firebase-tools use schedule-checker-b0eb7
npx firebase-tools deploy --only firestore:rules
```

**방법 B — Firebase 콘솔**

1. [Firebase 콘솔](https://console.firebase.google.com/) → 프로젝트 **schedule-checker-b0eb7**
2. **Firestore Database** → **규칙** 탭
3. 프로젝트 루트의 `firestore.rules` 내용을 복사해 붙여넣기 → **게시**

---

## 2. 데일리 요약 Cron (Vercel)

프로젝트에 `vercel.json` 이 있으며, **매일 09:00 UTC**(한국 시간 18:00)에 `/api/automation/daily-summary` 가 호출되도록 설정했습니다.

- Vercel 대시보드 → 해당 프로젝트 → **Settings** → **Cron Jobs** 에서 확인 가능합니다.
- 한국 시간 **09:00**에 받고 싶다면 `vercel.json` 의 `schedule` 을 `"0 0 * * *"` (00:00 UTC) 로 바꾸면 됩니다.

---

## 3. 연락처·알림·미팅(work_logs) Admin SDK

코드에서 **API는 모두 `firestoreAdmin`** 을 사용하도록 전환했습니다.  
연락처 추가/수정/삭제, 미팅 분석 저장·목록, 알림 조회·생성이 배포 환경에서도 동작합니다.

---

## 4. Slack 알림 연동

코드 반영: 지연 감지 시·데일리 요약 실행 시 `SLACK_WEBHOOK_URL` 이 있으면 해당 채널로 메시지가 전송됩니다.

**당신이 할 일**

1. [Slack API](https://api.slack.com/apps) → **Create New App** → **From scratch**
2. 앱 이름·워크스페이스 선택 후 생성
3. **Incoming Webhooks** → On → **Add New Webhook to Workspace** → 알림 받을 채널 선택 후 **Webhook URL** 복사
4. **Vercel** (및 로컬 `.env.local`) 환경 변수 추가:
   - **Name**: `SLACK_WEBHOOK_URL`
   - **Value**: 복사한 URL (예: `https://hooks.slack.com/services/xxx/yyy/zzz`)

저장 후 재배포하면, **지연 감지 알림**과 **데일리 요약**이 해당 Slack 채널로 전송됩니다.

---

## 5. Google Calendar 연동

**구성 요소 (코드에 반영된 것)**

- 설정 화면에 **Google Calendar 연동** 버튼
- OAuth 인증 후 토큰 저장 (`calendar_tokens/{uid}`)
- **업무 생성/수정/삭제 시 자동으로 Google Calendar 이벤트 동기화**
  - 마감일(`dueAt`)이 있는 업무 → 캘린더 이벤트 생성
  - 업무 수정 시 → 캘린더 이벤트 업데이트
  - 마감일 제거 시 → 캘린더 이벤트 삭제
  - 업무 삭제 시 → 캘린더 이벤트 삭제
- **기존 업무 일괄 동기화** 버튼 (설정 페이지)
- 이벤트 알림: 1일 전 이메일, 1시간 전 팝업

**당신이 할 일**

1. [Google Cloud Console](https://console.cloud.google.com/) → 프로젝트 선택(또는 Firebase와 같은 프로젝트)
2. **API 및 서비스** → **사용자 인증 정보** → **사용자 인증 정보 만들기** → **OAuth 클라이언트 ID**
3. 애플리케이션 유형: **웹 애플리케이션**
4. **승인된 리디렉션 URI** 에 다음 추가:
   - 로컬: `http://localhost:4000/api/integrations/google-calendar/callback` (또는 사용 중인 포트)
   - 배포: `https://your-app.vercel.app/api/integrations/google-calendar/callback`
5. **클라이언트 ID** 와 **클라이언트 시크릿** 복사
6. 환경 변수 추가:
   - `GOOGLE_CALENDAR_CLIENT_ID` = 클라이언트 ID
   - `GOOGLE_CALENDAR_CLIENT_SECRET` = 클라이언트 시크릿
7. **API 및 서비스** → **라이브러리** → **Google Calendar API** 검색 후 **사용** 설정

**사용 방법**

1. 설정 페이지 → **Google Calendar 연동** → **Google 계정으로 연동** 클릭
2. Google 계정 로그인 및 권한 승인
3. 연동 완료 후:
   - **새 업무 생성 시**: 마감일이 있으면 자동으로 캘린더 이벤트 생성
   - **업무 수정 시**: 마감일 변경 시 캘린더 이벤트 자동 업데이트
   - **업무 삭제 시**: 관련 캘린더 이벤트 자동 삭제
   - **기존 업무 동기화**: 설정 페이지의 **기존 업무 동기화** 버튼으로 마감일이 있지만 캘린더 이벤트가 없는 업무들을 일괄 동기화

**참고**

- 캘린더 동기화 실패해도 업무 생성/수정/삭제는 정상적으로 동작합니다 (비동기 처리)
- 이벤트는 기본 1시간 길이로 생성되며, 마감일 시간을 시작 시간으로 사용합니다
- Task 모델에 `calendarEventId` 필드가 추가되어 이벤트 추적이 가능합니다

---

## 6. 모바일 UI/UX 최적화

다음이 반영돼 있습니다.

- 뷰포트 메타 태그 (이미 있으면 유지)
- 터치 영역 최소 44px, 여백·폰트 크기 조정
- 사이드바: 모바일에서 접기/펼치기 동작
- 대시보드·업무 목록·모달 등 작은 화면에서 레이아웃·스크롤 개선

추가로 원하는 동작(예: 하단 탭 바, 제스처)이 있으면 알려 주시면 됩니다.
