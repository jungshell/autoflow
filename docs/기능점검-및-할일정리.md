# AutoFlow 기능 점검 및 당신이 할 일 정리

한 번에 확인·설정할 수 있도록 정리했습니다.

---

## 1. 기능 점검 요약

### ✅ 구현되어 정상 동작하는 것

| 영역 | 내용 | 비고 |
|------|------|------|
| **대시보드** | 4개 카드(업무/미팅/PDF/이모지톤), 메트릭·링크 | 업무 건수는 API 호출 후 표시 |
| **업무** | 목록·필터·검색·일괄 선택·진행 중/완료·새 업무·수정·삭제·상세·QuickAdd·키보드(/, N) | **API는 Admin SDK 사용** → 환경 변수 필요 |
| **업무 상세** | `/tasks/[id]` 조회·수정·삭제 | 동일 API 사용 |
| **로그인/로그아웃** | Google 로그인, 헤더 버튼(로그인/로그아웃/설정) | Firebase Auth 사용 |
| **설정** | 테마, 연락처 링크, 템플릿 스케줄, 야간방해, 데일리 요약 시간 | localStorage 기반 |
| **레이아웃** | AppShell 헤더, 사이드바(호버 확장·클릭 고정), 연락처는 사이드바에서 제거·설정에서 진입 | |
| **미팅** | 회의 메모 입력·분석·결과 표시·회의 기록 목록·검색·정렬 | **저장(work_logs)은 아래 “확인 필요” 참고** |
| **PDF 리더** | 기록 목록·상세 | **데이터는 work_logs, 확인 필요** |
| **이모지 톤** | 목적 선택·텍스트 분석·톤 변환 결과·복사 | **분석 결과 저장 시 확인 필요** |
| **연락처** | 설정/업무 페이지에서 진입·추가·수정·삭제 | **API는 아직 클라이언트 SDK 사용 → 확인 필요** |
| **알림 센터** | 알림 목록 표시, 야간방해 시 표시 완화 | **조회/생성 API 확인 필요** |

### ⚠️ 환경에 따라 동작이 달라지는 것 (Firestore 규칙 + API 사용 방식)

현재 **업무(tasks)만** API에서 **Firebase Admin SDK**로 읽기/쓰기 합니다.  
나머지(연락처·알림·미팅/PDF/이모지 기록 등 **work_logs**)는 API가 **클라이언트 Firebase SDK**를 사용합니다.

- Firestore 규칙이 `request.auth != null`을 요구하고,
- API 라우트는 서버에서 실행될 때 **사용자 토큰 없이** Firestore에 접속하므로,

**로그인한 사용자라고 해도** 아래 기능들이 **실패하거나 빈 목록만 나올 수 있습니다.**

| 기능 | 사용 API/데이터 | 예상 현상 | 권장 조치 |
|------|------------------|-----------|-----------|
| **연락처** 추가/수정/삭제·목록 | ` firestore` (클라이언트 SDK) | 403 또는 실패 | Admin SDK로 연락처 CRUD 전환 |
| **미팅** 분석 후 저장·회의 기록 보기 | `createWorkLog`, `getWorkLogs` | 저장 실패·목록 비어 있음 | work_logs용 Admin 함수 추가 후 API에서 사용 |
| **PDF 리더** 기록 목록 | `getWorkLogs` (source=pdf) | 목록 비어 있음 | 위와 동일 |
| **이모지 톤** 분석 결과 저장 | `createWorkLog` (해당 시) | 저장 실패 가능 | 위와 동일 |
| **알림** 목록·자동 생성(지연/데일리 요약) | `getAlerts` / `createAlert` | 알림 없음·자동화 실패 | alerts용 Admin 함수 추가 후 API·automation에서 사용 |
| **지연 감지** (delay-detection) | `getTasks`·`createAlert` (firestore) | getTasks 빈 배열·알림 미생성 | automation에서 Admin 또는 Admin용 getTasks/createAlert 사용 |
| **데일리 요약** (daily-summary) | `getTasks`·`createAlert` (firestore) | 동일 | 위와 동일 |

정리하면, **“당신이 할 일”** 에서 **환경 변수 설정**만 하면 **업무** 기능은 끝까지 동작하고,  
연락처·미팅/PDF/이모지 저장·알림·자동화까지 모두 안정시키려면 **나머지 API도 Admin SDK로 통일**하는 작업이 필요합니다.

---

## 2. 당신이 할 일 (한 번에 정리)

아래만 하면, 최소한 **업무 생성/수정/삭제·대시보드·로그인**은 환경에 맞게 동작합니다.

### 1) Firebase Admin 환경 변수 설정 (필수 — 업무 생성/수정 등)

로컬:

- 프로젝트 루트에 `.env.local` 파일을 만들고 아래 **둘 중 하나**만 설정합니다.

**방식 A (권장)**  
서비스 계정 JSON 전체를 한 줄로 넣기:

- Firebase 콘솔 → 프로젝트 설정 → 서비스 계정 → “키 생성” → JSON 파일 내려받기  
- 해당 JSON을 **한 줄 문자열**로 만들어서 아래처럼 넣기 (따옴표 이스케이프)

```bash
# .env.local
FIREBASE_SERVICE_ACCOUNT_JSON={"type":"service_account","project_id":"schedule-checker-b0eb7",...}
```

**방식 B**  
개별 변수로 넣기:

- JSON 키 파일에서 `project_id`, `client_email`, `private_key` 를 복사해서 넣기.

```bash
# .env.local
FIREBASE_PROJECT_ID=schedule-checker-b0eb7
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@schedule-checker-b0eb7.iam.gserviceaccount.com
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
```

- `.env.local`은 **절대 Git에 올리지 않기** (이미 `.gitignore`에 있을 수 있음).

설정 후 **개발 서버 재시작**:

```bash
npm run dev
```

이후 **새 업무 만들기·수정·삭제**가 동작하는지 한 번씩 확인하면 됩니다.

---

### 2) 배포 시 (Vercel 등)

- 배포 플랫폼의 **환경 변수**에 위와 동일하게  
  `FIREBASE_SERVICE_ACCOUNT_JSON` (또는 방식 B 세 개) 를 설정.
- Firebase 콘솔 → **Authentication → 설정 → 승인된 도메인**에  
  배포 주소(예: `your-app.vercel.app`) 추가.
- 자세한 절차는 `docs/DEPLOY-CHECKLIST.md` 참고.

---

### 3) (선택) 연락처·미팅·알림·자동화까지 완전히 쓰려면

- **구현 측**에서 다음을 하면 됩니다 (원하시면 이후 작업으로 이어갈 수 있음).
  - `src/lib/firestoreAdmin.ts` 에 연락처·알림·work_logs용 함수 추가 (getContacts, createContact, getAlerts, createAlert, getWorkLogs, createWorkLog 등).
  - 해당 API 라우트들(`/api/contacts`, `/api/alerts`, `/api/analyze`, `/api/search`, `/api/logs`, automation)에서 **firestore 대신 firestoreAdmin** 사용.
  - `src/lib/automation.ts` 의 `getTasks` / `createAlert` 를 **Admin 기반** 함수로 바꾸거나, API를 거치도록 변경.

당신이 할 일은 **1)·2) 까지 설정**하고,  
연락처/미팅/알림을 실제로 쓸 때 문제가 있으면 **3)** 을 진행하라고 개발자에게 요청하면 됩니다.

---

## 3. 빠른 체크리스트 (당신이 할 일만)

**이미 전에 `.env.local`에 FIREBASE_SERVICE_ACCOUNT_JSON(또는 방식 B 세 변수)을 넣었다면**  
→ 추가로 넣을 필요 없이 **서버만 재시작**하면 됩니다. 터미널에서 `npm run dev` 중인 걸 종료한 뒤 다시 실행하세요.  
이후 **새 업무** 생성·수정이 되면 설정이 적용된 것입니다.

- [ ] `.env.local` 에 **FIREBASE_SERVICE_ACCOUNT_JSON** (또는 방식 B 세 개) 설정 *(이미 했다면 건너뛰기)*
- [ ] `npm run dev` 재시작 후 **새 업무** 생성·수정이 되는지 확인
- [ ] (배포할 경우) 배포 환경 변수에 동일 값 설정
- [ ] (배포할 경우) Firebase 승인된 도메인에 배포 URL 추가
- [ ] (선택) 연락처·미팅 저장·알림까지 필요하면, Admin 확장 작업 요청

이 문서는 `docs/기능점검-및-할일정리.md` 에 저장해 두었습니다. 필요할 때 이 파일만 열어서 진행하면 됩니다.
