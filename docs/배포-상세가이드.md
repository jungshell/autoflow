# AutoFlow 배포 상세 가이드 (Vercel 기준)

한 번에 따라 할 수 있도록 단계별로 적었습니다.

---

## 사전 준비

- **GitHub 계정** (또는 GitLab 등 Vercel이 연결 가능한 저장소)
- **Firebase 프로젝트** (이미 쓰는 `schedule-checker-b0eb7` 사용)
- **로컬에서 `.env.local`에 Firebase Admin 설정**이 되어 있으면, 그 값을 배포할 때 그대로 쓰면 됩니다.

---

## 1단계: 코드를 GitHub에 올리기

1. 터미널에서 프로젝트 폴더로 이동합니다.
   ```bash
   cd "/Volumes/Samsung USB/schedule_checker"
   ```
2. Git이 아직 초기화 안 됐다면:
   ```bash
   git init
   ```
3. GitHub에서 **새 저장소(Repository)** 만듭니다.  
   (예: `autoflow` 라는 이름, Private/Public 상관없음)
4. 로컬과 연결 후 푸시합니다 (저장소 주소는 본인 것으로 바꾸세요).
   ```bash
   git remote add origin https://github.com/본인계정/autoflow.git
   git add .
   git commit -m "Initial commit"
   git branch -M main
   git push -u origin main
   ```
   - **주의**: `.env.local` 은 절대 커밋하지 마세요. 보통 `.gitignore` 에 이미 들어 있습니다.

---

## 2단계: Vercel에서 프로젝트 만들기

1. 브라우저에서 [vercel.com](https://vercel.com) 접속 후 로그인합니다.
2. **Add New…** → **Project** 를 클릭합니다.
3. **Import Git Repository** 에서 방금 올린 GitHub 저장소를 고릅니다.  
   (처음이면 GitHub 계정 연동 후 저장소 목록에 나타납니다.)
4. **Import** 를 누릅니다.
5. **Configure Project** 화면에서:
   - **Framework Preset**: Next.js 로 되어 있는지 확인.
   - **Build Command**: 비우거나 `npm run build` 그대로 사용.
   - **Output Directory**: 비우거나 `.next` 그대로 사용.
   - **Root Directory**: 비워 둡니다 (프로젝트 루트가 맞다면).
6. **Deploy** 를 눌러 **첫 배포**를 먼저 돌립니다.  
   (이 단계에서는 환경 변수 없어도 빌드만 되면 됩니다. 업무 생성 등은 다음 단계 후에 동작합니다.)

---

## 3단계: Vercel에 환경 변수 넣기

1. Vercel 대시보드에서 방금 만든 **프로젝트**를 엽니다.
2. 상단 **Settings** 탭으로 갑니다.
3. 왼쪽 메뉴에서 **Environment Variables** 를 클릭합니다.
4. **Key** 와 **Value** 를 넣습니다.

**방식 A (권장)**  
- **Key**: `FIREBASE_SERVICE_ACCOUNT_JSON`  
- **Value**: 로컬 `.env.local` 에 넣어 둔 **서비스 계정 JSON 전체**를 그대로 붙여넣습니다.  
  - 한 줄로 붙여넣어도 되고, 여러 줄로 넣어도 Vercel은 대부분 잘 처리합니다.  
  - JSON 안에 큰따옴표(`"`)가 많으므로, “값 전체를 한 번에 붙여넣기”로 넣는 것이 안전합니다.
- **Environment**: **Production**, **Preview**, **Development** 세 곳 모두 체크해 두면 편합니다.
- **Save** 를 누릅니다.

**방식 B**  
로컬에서 방식 B(개별 변수 3개)를 썼다면, 아래 세 개를 각각 추가합니다.

- `FIREBASE_PROJECT_ID` = JSON의 `project_id` 값  
- `FIREBASE_CLIENT_EMAIL` = JSON의 `client_email` 값  
- `FIREBASE_PRIVATE_KEY` = JSON의 `private_key` 값 (따옴표 포함, 줄바꿈은 `\n` 그대로)

5. 환경 변수를 저장한 뒤 **반드시 재배포**해야 적용됩니다.  
   **Deployments** 탭 → 가장 위 배포 오른쪽 **⋮** → **Redeploy** → **Redeploy** 한 번 더 누릅니다.

---

## 4단계: Firebase 승인된 도메인 추가

1. [Firebase 콘솔](https://console.firebase.google.com/) → 프로젝트 **schedule-checker-b0eb7** 선택.
2. 왼쪽 **Build** → **Authentication** → **Settings** 탭(또는 **설정**).
3. **Authorized domains**(승인된 도메인) 목록을 봅니다.
4. **Add domain** 을 누르고, Vercel에서 준 **도메인만** 입력합니다.  
   - 예: `your-project.vercel.app`  
   - `https://` 나 경로는 넣지 않고, **도메인 이름만** 넣습니다.
5. 저장하면 Google 로그인 등이 배포 사이트에서 동작할 수 있습니다.

---

## 5단계: Firestore 규칙 배포 (아직 안 했다면)

로컬 규칙을 그대로 쓰려면 Firebase에 반영해야 합니다.

**방법 1 — Firebase CLI (터미널)**

```bash
cd "/Volumes/Samsung USB/schedule_checker"
npm install -g firebase-tools
firebase login
firebase use schedule-checker-b0eb7
firebase deploy --only firestore:rules
```

**방법 2 — Firebase 콘솔**

1. Firebase 콘솔 → **Firestore Database** → **규칙** 탭.
2. 프로젝트 루트에 있는 `firestore.rules` 파일 내용을 복사해 붙여넣습니다.
3. **게시** 또는 **Publish** 를 누릅니다.

---

## 6단계: 배포 확인

1. Vercel **Deployments** 에서 최신 배포 상태가 **Ready** 인지 봅니다.
2. **Visit** 또는 배포 URL로 접속합니다.
3. **Google 로그인** → **업무** 페이지에서 **새 업무** 생성·수정이 되는지 확인합니다.  
   - 이때 3단계 환경 변수가 제대로 들어가고 재배포까지 했다면, 업무 생성이 되어야 합니다.

---

## 요약 체크리스트

| 순서 | 할 일 | 완료 |
|------|--------|------|
| 1 | 코드를 GitHub 저장소에 푸시 (`.env.local` 제외) | ☐ |
| 2 | Vercel에서 해당 저장소 Import 후 첫 Deploy | ☐ |
| 3 | Vercel **Settings → Environment Variables** 에 `FIREBASE_SERVICE_ACCOUNT_JSON` (또는 방식 B 세 개) 추가 | ☐ |
| 4 | **Redeploy** 한 번 실행 | ☐ |
| 5 | Firebase **Authentication → 승인된 도메인**에 Vercel 도메인 추가 | ☐ |
| 6 | (선택) Firestore 규칙 배포 (`firebase deploy --only firestore:rules` 또는 콘솔 복붙) | ☐ |
| 7 | 배포 URL에서 로그인 후 새 업무 생성 테스트 | ☐ |

---

## 자주 하는 질문

**Q. 이미 `.env.local` 에 넣어 뒀어요.**  
→ 로컬은 그대로 두고, **서버만 재시작**(`npm run dev` 다시 실행)하면 됩니다.  
배포할 때는 **같은 값**을 Vercel 환경 변수에 한 번 더 넣으면 됩니다.

**Q. Vercel 도메인이 뭐예요?**  
→ 프로젝트 **Settings → Domains** 에 보입니다. 기본은 `프로젝트이름.vercel.app` 입니다.

**Q. 배포 후에도 “업무 생성에 실패했습니다” 가 나와요.**  
→ 3단계 환경 변수 입력 후 **Redeploy**를 했는지 확인하세요. 값에 줄바꿈·따옴표가 깨지지 않았는지도 점검하면 좋습니다.

이 가이드는 `docs/배포-상세가이드.md` 에 저장되어 있습니다. 배포할 때 이 파일만 따라 하시면 됩니다.
